- []()
- [盖楼式评论](#盖楼式评论)

### 直接回复

### 盖楼式评论
![盖楼](https://github.com/xiazhibin/blog/blob/master/pic/%E7%BD%91%E6%98%93%E7%9B%96%E6%A5%BC.jpeg)

这种评论方式可以通过两个表即可实现

```sql
create table floor
(
  id           serial not null constraint floor_pkeyprimary key,
  comment_ids integer []
);

create table comment
(
  id          serial not null constraint comment_pkey primary key,
  build_level integer,
  content     text
);
```

#### 分析

`floor.comment_ids` 表保存该楼层引用的`comment_ids`,利用`build_level`来记录是楼中第几楼

#### 插入
```python

if floor_id == -1:
    comment = insert_comment() # 插入一个comment
    insert_floor(comment.id) # 插入一个floor
else:
    floor = select_floor(floor_id)
    last_comment = floor.comment_ids[-1] # 找到该楼层最后一个comments
    comment = insert_comment(last_comment.build_level+1) # 插入一个comment
    update_floor_comment_ids(comment.id) # 将新增的comemnt添加到floor的comment_ids中
```

#### 返回数据形式
```json
comments:
    3: {'build_level': 0, 'content': "1L", 'id': 3}
    4: {build_level: 0, content: "4L", id: 4}
    5: {build_level: 0, content: "2L", id: 5}
    6: {build_level: 0, content: "3L", id: 6}
    25: {build_level: 1, content: "1L中的2L", id: 25}
    26: {build_level: 2, content: "1L中的3L", id: 26}
floors: 
    1: [3, 25, 26]
    2: [4]
    3: [5]
    4: [6]
```
